const { IgApiClient } = require('instagram-private-api');
const { sample } = require('lodash');

const ig = new IgApiClient();
const username = 'not_full_speed';
const password = 'icikiwir1';

const emojis = ['ğŸ˜‚', 'ğŸ”¥', 'ğŸ‰', 'ğŸ’¯', 'ğŸ˜', 'ğŸ‘', 'ğŸ™', 'ğŸ˜', 'ğŸ¤¯', 'ğŸ™Œ', 'ğŸ¥³', 'ğŸ’ª', 'ğŸ¶', 'ğŸ«¶', 'ğŸ’–'];
const targetUser = 'xyzbl_hnz';

(async () => {
    try {
        ig.state.generateDevice(username);
        await ig.account.login(username, password);
        console.log("âœ… Login berhasil!");

        while (true) {
            const inboxFeed = ig.feed.directInbox();
            const threads = await inboxFeed.items();

            for (let thread of threads) {
                if (!thread.last_permanent_item || thread.last_permanent_item.user_id === ig.state.cookieUserId) {
                    continue; // Lewati jika pesan terakhir dari bot sendiri
                }

                const user = thread.users[0].username;
                const threadId = thread.thread_id;

                let emoji = (user === targetUser) ? 'â¤ï¸' : sample(emojis);

                await ig.entity.directThread(threadId).broadcastText(emoji);
                console.log(`âœ… Membalas @${user} dengan ${emoji}`);
            }

            await new Promise(resolve => setTimeout(resolve, 30000)); // Cek setiap 30 detik
        }
    } catch (error) {
        console.error('âŒ Terjadi kesalahan:', error);
    }
})();